language: objective-c
matrix:
  include:
  - osx_image: xcode9.3
    env: XCODE_VER=93
  - osx_image: xcode9.2
    env: XCODE_VER=92
branches:
  only:
  - master
env:
  global:
    - UNIVERSAL_OUTPUTFOLDER=universal BUILD_DIR=travisiOSsample-distributable
before_script:
  - brew tap tcnksm/ghr
  - brew install ghr
script:
  - mkdir -p $UNIVERSAL_OUTPUTFOLDER
  - xcodebuild -target "travisiOSsample" -configuration Release ONLY_ACTIVE_ARCH=NO -sdk iphoneos  BUILD_DIR=$BUILD_DIR clean build
  - xcodebuild -target "travisiOSsample" -configuration Release -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO BUILD_DIR=$BUILD_DIR clean build
  - cp -R $BUILD_DIR/Release-iphoneos/travisiOSsample.framework $UNIVERSAL_OUTPUTFOLDER/
  - cp -R $BUILD_DIR/Release-iphonesimulator/travisiOSsample.framework/Modules/travisiOSsample.swiftmodule/. $UNIVERSAL_OUTPUTFOLDER/travisiOSsample.framework/Modules/travisiOSsample.swiftmodule
  - lipo -create -output $UNIVERSAL_OUTPUTFOLDER/travisiOSsample.framework/travisiOSsample $BUILD_DIR/Release-iphonesimulator/travisiOSsample.framework/travisiOSsample $BUILD_DIR/Release-iphoneos/travisiOSsample.framework/travisiOSsample
  - mv $UNIVERSAL_OUTPUTFOLDER/travisiOSsample.framework .
  - tar -cvzf travisiOSsample-iOS-$XCODE_VER.tar.gz travisiOSsample.framework
  - mkdir releases
  - mv travisiOSsample-iOS-*.tar.gz releases/

after_script:
  - ghr v1.9.0 releases/ -t d8c24d45ce5d9f8138dc916a5c0bb099e73dbae3 -u shreyaganguly1 -r helloworld -c master
