language: objective-c
matrix:
  include:
  - osx_image: xcode9.3
    env: XCODE_VER=93
  - osx_image: xcode9.2
    env: XCODE_VER=92
branches:
  only:
  - master
env:
  global:
  - UNIVERSAL_OUTPUTFOLDER=universal BUILD_DIR=travisiOSsample-distributable
  - secure: l44iaTHdL4J4ePXWNA1Ja9RuWqNvgZdM7ymA5JYbEpXUwZcl6DKGH5N8ropmwnxzmSLp+1t5us1S6NJRJBCBU8xd59/Y7ohKYoleOcYk5Fl4rPoilyw4TM8j00PdPBriqWZ5+QBeNxUpohWXbKSfHCYYJPiyBD16+M+8zCAxkzvT3HXe/f5pJ4/XuedUqUx02tERPs7L71Q5sbvpa9K3koRL4fPM5QKvSNyww0ayxZt5kQTHe+ULt8LNsEn6MN60kUdcTahJZT/NZEh4wyniJblSllz5TXAKL47dnAtSni2cODlWRJLvjFZyCa1Olq6UpHegC8RqlAJyR4znzMGiG07/fQuonVoYi1pBW3BCfcx5tBH9TSpF8MUz97S66Ef7r7cc4aojmov1LLQ5p1/R0oP4yHuSMjCjLirc36QQS0ADVXITpkqG3NM4bnwtY5QEW/GagSG2ZrV6917HHUlsUT7JdFL3J2Ct8YVEikjrXo/2s30mvprJ0vOgBUqoL07lcVamjGRpqigyS39hsqFfv9MTeNkEGVc/3BBR6Iou2xJNgUGRheuPKIhdAKtwGOruV1i5as3+hD/Afq5uwHYRmqgc8piOOgX0UzHDMSNW6/m24NbYTY6rdD2UKRhLixefow1ItsHKdIDiVLXtOyWSThsaika+fOuzohZK5YQ72jQ=
before_script:
- brew tap tcnksm/ghr
- brew install ghr
script:
- mkdir -p $UNIVERSAL_OUTPUTFOLDER
- xcodebuild -target "travisiOSsample" -configuration Release ONLY_ACTIVE_ARCH=NO
  -sdk iphoneos  BUILD_DIR=$BUILD_DIR clean build
- xcodebuild -target "travisiOSsample" -configuration Release -sdk iphonesimulator
  ONLY_ACTIVE_ARCH=NO BUILD_DIR=$BUILD_DIR clean build
- cp -R $BUILD_DIR/Release-iphoneos/travisiOSsample.framework $UNIVERSAL_OUTPUTFOLDER/
- cp -R $BUILD_DIR/Release-iphonesimulator/travisiOSsample.framework/Modules/travisiOSsample.swiftmodule/.
  $UNIVERSAL_OUTPUTFOLDER/travisiOSsample.framework/Modules/travisiOSsample.swiftmodule
- lipo -create -output $UNIVERSAL_OUTPUTFOLDER/travisiOSsample.framework/travisiOSsample
  $BUILD_DIR/Release-iphonesimulator/travisiOSsample.framework/travisiOSsample $BUILD_DIR/Release-iphoneos/travisiOSsample.framework/travisiOSsample
- mv $UNIVERSAL_OUTPUTFOLDER/travisiOSsample.framework .
- tar -cvzf travisiOSsample-iOS-$XCODE_VER.tar.gz travisiOSsample.framework
- mkdir releases
- mv travisiOSsample-iOS-*.tar.gz releases/
after_script:
  deploy:
  provider: script
  script: ghr -t $TOKEN -u shreyaganguly1 -r helloworld -c master v1.9.0 releases/
